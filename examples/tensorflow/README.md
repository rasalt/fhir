# Example code to train a TensorFlow model from FHIR Bundles

This directory contains example code to generate labels and training examples
for a tensorflow model, as well as for training such a model.

We use synthetic data from [Synthea](https://syntheticmass.mitre.org/) which is
parsed into protocol buffers. Labels are generated from the bundles for a
length-of-stay task using an inpatient cohort. Samples are split into train,
validation, and test.

Some temporary files will be generated by this example, in the directory passed
as an argument to the scripts. Beware that some steps can take many minutes to
execute.

To run this sample:

```
MY_DIR=/tmp/synthea
./01-get-synthea.sh $MY_DIR
./02-convert-bundles.sh $MY_DIR
./03-generate-labels.sh $MY_DIR
./04-generate-examples.sh $MY_DIR
./05-train-model.sh $MY_DIR
```

In addition, this directory contains a Jupyter notebook which illustrates
how to set up a tf.Estimator to predict the length-of-stay of a patient.

The input data are the tf.SequenceExamples stored in a path generated from the
data generation pipeline. For testing purposes, the notebook also supports
running over a single synthetic example.

For instructions on how to install or upgrade Tensorflow to version 1.12.0 or
higher using a virtual environment, see
https://www.tensorflow.org/install/

